#!/bin/ksh
_rpnpy_dev_mode_="$1"
if [[ x"$_rpnpy_dev_mode_" == x"--dev" ]] ; then
   shift
   echo 'Loading dev env: ssmusedep-dev.bndl'
   . s.ssmuse.dot $(cat ssmusedep-dev.bndl)
else
   echo 'Loading Run-time env'
fi

for _myfile in ssmusedep_${COMP_ARCH}.bndl ssmusedep.bndl ssmusedep_post.bndl ; do
   if [[ -f ${_myfile} && -s ${_myfile} ]] ; then
      echo ". s.ssmuse.dot ${_myfile}"
      . s.ssmuse.dot $(cat ${_myfile})
   fi
done
unset _myfile

rpnpy_version=dev
if [[ -f VERSION ]] ; then
   rpnpy_version="$(cat VERSION)"
fi

. $(pwd)/bin/.env_setup.dot rpnpy ${rpnpy_version} all $(pwd) $(pwd)

if [[ x"$_rpnpy_dev_mode_" == x"--dev" ]] ; then
   _rpnpy_rde_libdir_=$(rdevar build/lib)
   _rpnpy_rde_libdir0_=build-${ORDENV_PLAT}/lib/${COMP_ARCH}
fi

export PATH=$(pwd)/bin:$PATH
export PYVERSION="$(python -V 2>&1 | cut -d' ' -f2 | cut -d'.' -f1-2)"
export PYTHONPATH=$(pwd):$(pwd)/build/lib.$(uname -s | tr 'A-Z' 'a-z')-$(uname -m)-${PYVERSION}:$PYTHONPATH
export LD_LIBRARY_PATH=$(pwd)/build/lib.$(uname -s | tr 'A-Z' 'a-z')-$(uname -m)-${PYVERSION}:$(pwd)/${_rpnpy_rde_libdir_:-${_rpnpy_rde_libdir0_}}:$LD_LIBRARY_PATH

if [[ x"$_rpnpy_dev_mode_" == x"--dev" ]] ; then
   unset _rpnpy_rde_libdir_ _rpnpy_rde_libdir0_
fi
unset _rpnpy_dev_mode_
